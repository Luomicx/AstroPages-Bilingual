---
title: CloudFlare与Versel配置冲突问题
pubDatetime: 2025-03-30T13:45:40Z
description: CloudFlare与Versel配置冲突问题解决方案
featured: true
draft: false
tags:
  - 技术博客
---

# 一、CloudFlare：网络安全和性能优化的托管平台

<img src="http://imgbed.sut.qzz.io/img/20250330165638285.webp" alt="image-20250330165638211" style="float: left"/>

Cloudflare 是一家提供网络安全、性能优化服务的平台，核心功能包括：

- **CDN 加速**：在全球部署节点，缓存网站静态资源，缩短用户访问延迟。
- **智能 DNS 解析**：提供高效的 DNS 服务，支持智能解析，根据用户位置返回最优 IP。
- **安全防护**：集成 Web 应用防火墙（WAF）、DDoS 防护等功能，抵御恶意攻击。
- **反向代理**：用户请求先经 Cloudflare 服务器转发至源站，隐藏源站真实 IP，同时提供流量优化、缓存管理等能力

# 二、Versel：前端开发者的部署神奇

![image-20250330165916106](http://imgbed.sut.qzz.io/img/20250330165916369.webp)

Vercel 专为前端应用和静态网站设计，优势如下：

- **一键部署**：与代码仓库（如 GitHub）深度集成，推送代码自动触发部署。
- **域名管理友好**：支持自定义域名，简化域名配置流程，自动处理 SSL 证书。
- **边缘网络优化**：通过边缘网络分发内容，提升全球用户访问速度。

# 三、问题出现

## 1.问题场景复现

​ 在将我的域名 `wiretender.top` 托管到 **CloudFlare** 平台之后，而且先前我已经在 **Versel** 配置过相关的自定义域名，根据我的 GitHub 仓库。但是在开启 **CloudFlare** 的代理服务之后，再次访问网站发现出现错误显示：

**www.wiretender.top 重定向次数过多！**

## 2.原因解析

### （1）反向代理的流量干扰

**CloudFlare** 作为反向代理，会对我们访问的流量进行缓存和转发处理。若其缓存策略错误（比如缓存了错误的重定向规则），或者转发逻辑和 **Versel** 配置冲突，会导致循环重定向。关闭代理后，流量直连 **Versel**，绕开了 **CloudFlare** 的反向代理，绕开了其可能错误的处理流程。

### （2）DNS 配置与代理的联动影响

**Cloudflare** 的 **DNS** 代理模式（橙色云）会修改 **DNS** 解析行为。若 **CNAME** 记录指向错误目标，或 A 记录关联 IP 与 **Vercel** 部署不匹配，代理状态会放大这种配置错误的影响。关闭代理后，DNS **解析** 回归原始逻辑，错误配置的影响被消除。

### （3）安全规则与部署环境的适配问题

**Cloudflare** 的 **WAF** 规则若设置不当，可能误判正常请求为攻击行为，触发额外的重定向或拦截。而 **Vercel** 部署环境对流量路径有特定要求，两者适配不佳时，关闭 **Cloudflare** 代理可规避安全规则对 **Vercel** 服务的干扰。

# 四、总结

![image-20250330165948725](http://imgbed.sut.qzz.io/img/20250330165948964.webp)

​ 首先问题开始是因为我在配置我的二级域名 `imgbed.sut.qzz.io` 来进行对 **CloudFlare** 的 **R2** 的存储桶（Bucket）进行配置为我的图床，然后开始直接使用了**一级域名**导致相关配置**出错**，导致我的主机记录 **A** 从我的 **DNS** 记录中消失，导致网站无法正常访问，后来查阅资料使用了**二级域名**来解决这个问题，但是之前是在我购买域名的服务官网来进行配置的（如上图），这样配置的 **DNS** 记录不会出现 **CloudFlare** 的反向代理问题，所以现在出现了如上的情况，在仔细排查了 **DNS** 配置相关规则后成功的完成了这个问题的解决。
